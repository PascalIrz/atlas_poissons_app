---
title: "Atlas des poissons de Bretagne"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include = FALSE, echo = FALSE}
library(flexdashboard)
library(plotly)
library(shiny)
library(mapview)
library(leaflet)
library(tidyverse)
library(lubridate)
library(sf)
library(aspe)
library(atlaspoissons)
library(devtools)
```


```{r}
load(file = "donnees_appli.RData")
```

Sidebar {.sidebar data-width=350}
=====================================

```{r}

selectInput(
  "espece",
  "Choisissez une espèce",
  choices = unique(pt_data$esp_nom_commun),
  selected = 1
)

                   

```




# Carte de synthèse


```{r, echo = FALSE}
# Inspiration : https://www.infoworld.com/video/95368/how-to-boost-r-markdown-interactivity-with-runtime-shiny

sliderInput(inputId = "annees",
            label = "Suivi temporel",
            min = min(pt_data$annee, na.rm = TRUE),
            max = max(pt_data$annee, na.rm = TRUE),
            value = c(min(pt_data$annee, na.rm = TRUE),
                      max(pt_data$annee, na.rm = TRUE)) ,
            round = TRUE,
            sep = "")

esp_nom_commun <- reactive({pt_data %>% 
    slice(1) %>% 
    pull(code_espece) %>% 
    paste0(" : ", input$espece)
  })

sel_pt_data <- reactive({pt_data %>%
    filter(esp_nom_commun == input$espece)
  })
```

<!-- Nombre de sites (points) échantillonnés au moins `r reactive({input$n_annees})` années : `r reactive({n_pops()})` -->

```{r, echo = FALSE}
# solution trouvée sur https://stackoverflow.com/questions/36679944/mapview-for-shiny

# m1 <- reactive({
#   mapview::mapview(datapt(), zcol="presence")%>%
#     .@map
#   })
n_lignes <- reactive({
  sel_pt_data() %>%
    nrow()

})

lignes <- reactive({
  
  sel_pt_data() %>%
    head() %>% 
    DT::renderDataTable()
  })
```


```{r, echo = FALSE}
renderValueBox(esp_nom_commun())
renderValueBox(paste0(n_lignes(), " observations"))
#
DT::renderDataTable({lignes()})
#
DT::dataTableOutput(lignes())

```


```{r}
    # zoom_level <- reactive({
    #     if(is.null(input$m1_zoom)) {
    #       zoom <- 6
    #     } else {
    #       zoom <- input$m1_zoom
    #     }
    #   zoom
    # })
```

<!-- zoom_level : `r reactive({zoom_level()})` -->


```{r, echo = FALSE}
# solution trouvée sur https://stackoverflow.com/questions/36679944/mapview-for-shiny

# leaflet::renderLeaflet({
#   m1() %>%
#     leaflet::setView(-3, 48, zoom = 8)
#   })

```



# Méthodologie

Expliquer ici la méthodologie

```{r, eval = FALSE, echo = TRUE}

```









